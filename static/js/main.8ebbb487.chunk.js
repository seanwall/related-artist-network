(this["webpackJsonpspotify-artist-graph"]=this["webpackJsonpspotify-artist-graph"]||[]).push([[0],{19:function(e,t,n){},20:function(e,t,n){},44:function(e,t,n){e.exports=n(54)},49:function(e,t,n){},50:function(e,t,n){},52:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(21),o=n.n(a),s=(n(49),n(14)),c=n(2),d=n(3),l=n(5),u=n(4),p=(n(50),""),h=function(){return fetch("https://young-garden-14101.herokuapp.com/spotify/auth").then((function(e){return e.json()})).then((function(e){return p=e}))},m=function(e){return fetch("https://api.spotify.com/v1/search?q=".concat(encodeURIComponent(e.trim()),"&type=artist"),{headers:{Authorization:"Bearer "+p}}).then((function(e){return e.json()}))},f=function(e){return fetch("https://api.spotify.com/v1/artists/".concat(e,"/related-artists"),{headers:{Authorization:"Bearer "+p}}).then((function(e){return e.json()}))},v=function(e){return fetch("https://api.spotify.com/v1/artists/".concat(e,"/top-tracks?country=US"),{headers:{Authorization:"Bearer "+p}}).then((function(e){return e.json()}))},g=n(8),_=(n(19),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={mouse_over:!1},i.track_title="",i.initializePreview=function(){i.props.node.track_promise.then((function(e){e&&(e.preview_url&&(i.preview_audio=new Audio(e.preview_url)),i.track_title=e.name)}))},i.handleMouseHover=function(e){switch(e){case"over":i.state.mouse_over||(i.props.setHovered(i.props.node.id),i.setState({mouse_over:!0}),i.preview_audio&&setTimeout((function(){i.state.mouse_over&&i.preview_audio.play()}),500));break;case"leave":i.props.setHovered(null),i.setState({mouse_over:!1}),i.preview_audio&&(i.preview_audio.pause(),i.preview_audio.currentTime=0)}},i}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.initializePreview()}},{key:"componentDidUpdate",value:function(e){this.props.node.id!==e.node.id&&(this.preview_audio=null,this.track_title="",this.initializePreview())}},{key:"getClassName",value:function(){return this.state.mouse_over?"active-node":this.props.node.sources&&this.props.node.sources.includes(this.props.hovered_node_id)?"child-node":this.props.node.targets&&this.props.node.targets.includes(this.props.hovered_node_id)?"parent-node":"hidden-node"}},{key:"render",value:function(){var e=this,t=this.props.getNodeTransform(),n=this.getClassName(),i=this.props.getRadius(),a=window.pageXOffset+window.innerWidth-20,o=window.pageYOffset+25,s=r.a.createElement("tspan",{className:"preview-text",y:o,x:a},this.props.node.name," - ",this.track_title);return r.a.createElement("g",{className:n,id:this.props.node.id,key:this.props.node.id,onClick:function(){return e.props.expand()},onMouseLeave:function(){return e.handleMouseHover("leave")},onMouseOver:function(){return e.handleMouseHover("over")}},this.state.mouse_over&&r.a.createElement("text",{id:"".concat(this.props.node.id,"-preview"),textAnchor:"end"},r.a.cloneElement(s,{className:"preview-underlay"}),r.a.cloneElement(s,{className:"preview-fill"}),!this.preview_audio&&r.a.createElement("tspan",{fill:"red",y:o+20,x:a},"No audio sample available")),r.a.createElement("circle",{transform:t,className:n,r:i}))}}]),n}(r.a.Component)),y=(n(20),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){return Object(c.a)(this,n),t.call(this,e)}return Object(d.a)(n,[{key:"getClassName",value:function(){return this.props.hovered_node_id===this.props.edge.source.id?"child-edge":this.props.hovered_node_id===this.props.edge.target.id?"parent-edge":"hidden-edge"}},{key:"render",value:function(){var e=this.getClassName();return r.a.createElement("line",{className:e,key:this.props.edge.id,x1:this.props.edge.source.x,x2:this.props.edge.target.x,y1:this.props.edge.source.y,y2:this.props.edge.target.y})}}]),n}(r.a.Component)),E=(n(52),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={is_highlighted:!1},i.track_id="",i.initializeNodeInfo=function(){i.setState({is_highlighted:i.isHighlighted()}),i.props.node.track_promise.then((function(e){e&&(i.track_id=e.id)}))},i}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.initializeNodeInfo()}},{key:"componentDidUpdate",value:function(e){this.props.hovered_node_id===e.hovered_node_id&&this.props.node.id===e.node.id||this.initializeNodeInfo()}},{key:"getClassName",value:function(){return this.props.node.id===this.props.hovered_node_id?"active-label":this.props.node.sources&&this.props.node.sources.includes(this.props.hovered_node_id)?"child-label":this.props.node.targets&&this.props.node.targets.includes(this.props.hovered_node_id)?"parent-label":void 0}},{key:"isHighlighted",value:function(){return this.props.node.id===this.props.hovered_node_id||this.props.node.sources&&this.props.node.sources.includes(this.props.hovered_node_id)||this.props.node.targets&&this.props.node.targets.includes(this.props.hovered_node_id)}},{key:"render",value:function(){var e=this.getClassName(),t=this.props.getLabelText();return r.a.createElement("g",null,!0===this.state.is_highlighted&&r.a.createElement("g",{id:"".concat(this.props.node.id,"-label")},r.a.cloneElement(t,{className:e}),r.a.cloneElement(t,{className:"label-fill"})),!0!==this.state.is_highlighted&&r.a.createElement("a",{href:"spotify:track:".concat(this.track_id)},r.a.cloneElement(t,{className:"hidden-label"})))}}]),n}(r.a.Component)),k=(n(53),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this,e)).state={hovered_node_id:null},i.nodes=[],i.edges=[],i.force=null,i.firstSim=!0,i.initializeNewGraph=function(){window.scrollTo(1e3-window.innerWidth/2,1e3-window.innerHeight/2);var e={id:i.props.initial_artist.id,sources:[],name:i.props.initial_artist.name,popularity:i.props.initial_artist.popularity,x:0,y:0,track_promise:i.props.initial_artist.track_promise};i.nodes=[e],i.edges=[],i.expandGraph(e).then((function(e){i.startD3Simulation()}))},i.getRelatedArtists=function(e){return f(e).then((function(e){return e.artists}))},i.getTrackForArtist=function(e){return v(e).then((function(e){return e.tracks[0]}))},i.expandGraph=function(e){return i.getRelatedArtists(e.id).then((function(t){var n=[],r=[],a=[];t.forEach((function(t){var o=t.id;if(a.push(o),i.nodes.filter((function(e){return e.id===t.id})).map((function(t){return t.sources.push(e.id)})),!i.nodes.some((function(e){return e.id===t.id}))){var s=i.getTrackForArtist(t.id).then((function(e){return e})),c={id:t.id,sources:[e.id],name:t.name,popularity:t.popularity,x:0,y:0,track_promise:s};n.push(c)}var d="e".concat(e.id,"-").concat(o);i.edges.some((function(e){return e.id===d}))||r.push({id:d,source:e.id,target:o})})),e.targets=a,i.nodes=i.nodes.concat(n),i.edges=i.edges.concat(r)}))},i.setHoveredNode=function(e){i.setState({hovered_node_id:e})},i.getRadius=function(e){return e/5+2},i.getLabelText=function(e){return r.a.createElement("text",{textAnchor:"middle",y:e.y+i.getRadius(e.popularity)+7,x:e.x,dy:".5em"},e.name)},i.getNodeTransform=function(e){return"translate("+e.x+","+e.y+")"},i}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.initializeNewGraph()}},{key:"componentDidUpdate",value:function(e){this.props.initial_artist!==e.initial_artist&&this.initializeNewGraph()}},{key:"startD3Simulation",value:function(){var e=this;this.force=g.e(this.nodes).force("charge",g.d().strength(-1e3)).force("link",g.c(this.edges).id((function(e){return e.id})).distance(90)).force("collide",g.b([25]).iterations([5])).force("center",g.a().x(1e3).y(1e3)),this.force.on("tick",(function(){e.forceUpdate()}))}},{key:"expandNode",value:function(e){var t=this;this.nodes.map((function(e){e.fx=e.x,e.fy=e.y})),this.force.force("center",null),this.expandGraph(e).then((function(e){t.force.nodes(t.nodes),t.force.force("link").links(t.edges),t.force.alpha(1).restart()}))}},{key:"render",value:function(){var e=this,t=this.edges.map((function(e){return r.a.createElement("line",{className:"edge",key:e.id,x1:e.source.x,x2:e.target.x,y1:e.source.y,y2:e.target.y})})),n=this.nodes.map((function(t){return r.a.createElement("circle",{className:"node",r:e.getRadius(t.popularity),transform:e.getNodeTransform(t)})})),i=this.nodes.map((function(t){return e.getLabelText(t)})),a=this.edges.map((function(t){return r.a.createElement(y,{edge:t,hovered_node_id:e.state.hovered_node_id})})),o=this.nodes.map((function(t){return r.a.createElement(_,{node:t,hovered_node_id:e.state.hovered_node_id,expand:function(){return e.expandNode(t)},setHovered:e.setHoveredNode,getRadius:function(){return e.getRadius(t.popularity)},getNodeTransform:function(){return e.getNodeTransform(t)}})})),s=this.nodes.map((function(t){return r.a.createElement(E,{node:t,hovered_node_id:e.state.hovered_node_id,getLabelText:function(){return e.getLabelText(t)}})})),c=[];return this.state.hovered_node_id&&(c=this.nodes.map((function(t){if(e.state.hovered_node_id===t.id||t.sources.includes(e.state.hovered_node_id)||t.targets&&t.targets.includes(e.state.hovered_node_id))return r.a.createElement(E,{node:t,hovered_node_id:e.state.hovered_node_id,getLabelText:function(){return e.getLabelText(t)}})}))),r.a.createElement("svg",{className:"graph",width:2e3,height:2e3,overflow:"auto"},r.a.createElement("g",null,r.a.createElement("g",{id:"base_edges"},t),r.a.createElement("g",{id:"base_nodes"},n),r.a.createElement("g",{id:"base_labels"},i),r.a.createElement("g",{id:"edges"},a),r.a.createElement("g",{id:"labels"},s),r.a.createElement("g",{id:"nodes"},o),c,this.state.hovered_node_id&&r.a.createElement("g",null,r.a.createElement("use",{xlinkHref:"#".concat(this.state.hovered_node_id,"-label")}),r.a.createElement("use",{xlinkHref:"#".concat(this.state.hovered_node_id,"-preview")}))))}}]),n}(r.a.Component)),b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={initial_artist:null,search_query:""},e.searchArtists=function(e){return m(e).then((function(e){return e.artists.items}))},e.getTrackForArtist=function(e){return v(e).then((function(e){return e.tracks[0]}))},e.setInitialArtist=function(t){t&&e.searchArtists(t).then((function(t){if(e.setState({search_query:""}),0===t.length)console.log("No artists found search again");else{var n=t[0],i=e.getTrackForArtist(n.id).then((function(e){return e}));e.setState({initial_artist:Object(s.a)(Object(s.a)({},n),{},{track_promise:i})})}}))},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){h()}},{key:"render",value:function(){var e=this,t=r.a.createElement("form",{className:"input-group input-group-sm",onSubmit:function(t){t.preventDefault(),e.setInitialArtist(e.state.search_query)}},r.a.createElement("input",{className:"form-control",onChange:function(t){return e.setState({search_query:t.target.value})},value:this.state.search_query,placeholder:"Artist name..."}),r.a.createElement("button",{className:"ml-2 mr-1 col-3",type:"submit"},"Go"));return r.a.createElement("div",{className:"container-fluid h-100 p-0"},!this.state.initial_artist&&r.a.createElement("div",{className:"row h-100 no-gutters"},r.a.createElement("div",{className:"col-2"}),r.a.createElement("div",{className:"col-8"},r.a.createElement("div",{className:"home-group"},r.a.createElement("p",{className:"text-center"},"This is an interactive music exploration tool built using related artist data from Spotify's Web API. Enter an artist name to start a graph."),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-1"}),r.a.createElement("div",{className:"col-10"},t))))),this.state.initial_artist&&r.a.createElement("div",null,r.a.createElement("div",{className:"h-25"},r.a.createElement("div",{className:"svg-key m-1 p-2"},r.a.createElement("p",{className:"m-0"},r.a.createElement("b",null,"Click")," on a node to explore"),r.a.createElement("p",{className:"m-0"},r.a.createElement("b",null,"Click")," on an artist's name to open their Spotify page"),r.a.createElement("p",{className:"m-0"},r.a.createElement("b",null,"Hover")," over a node to hear a sample"),t)),r.a.createElement(k,{initial_artist:this.state.initial_artist})))}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(b,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.8ebbb487.chunk.js.map